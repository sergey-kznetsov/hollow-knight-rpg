<form class="hkrpg sheet item-sheet" autocomplete="off">
  <header class="sheet-header">
    <div class="hkrpg-row">
      <img class="profile-img" src="{{item.img}}" data-edit="img" title="{{item.name}}" height="72" width="72" />

      <div style="flex:1; margin-left:10px;">
        <h2 style="margin:0;">
          <input name="name" type="text" value="{{item.name}}" />
        </h2>

        <div class="hkrpg-row" style="margin-top:6px;">
          <label style="min-width:120px;">{{localize "HKRPG.Item.Types.weapon"}}</label>
          <span class="hkrpg-pill">{{item.type}}</span>
        </div>
      </div>

      <div style="display:flex; flex-direction:column; gap:6px; align-items:flex-end;">
        <label class="hkrpg-row" style="gap:8px;">
          <input type="checkbox" name="system.equipped" {{checked system.equipped}} />
          <span>{{localize "HKRPG.Item.Common.equipped"}}</span>
        </label>

        <button type="button" class="item-roll" title="{{localize 'HKRPG.UI.Roll'}}">
          <i class="fas fa-dice"></i> {{localize "HKRPG.UI.Roll"}}
        </button>
      </div>
    </div>
  </header>

  <nav class="sheet-tabs tabs" data-group="primary">
    <a class="item" data-tab="details">Параметры</a>
    <a class="item" data-tab="mods">Модификации</a>
    <a class="item" data-tab="desc">{{localize "HKRPG.Item.Common.description"}}</a>
  </nav>

  <section class="sheet-body">
    <!-- DETAILS -->
    <div class="tab" data-group="primary" data-tab="details">
      <div class="hkrpg-grid hkrpg-cols-2">
        <div class="hkrpg-card">
          <h3>База</h3>

          <div class="hkrpg-row">
            <label>{{localize "HKRPG.Item.Weapon.type"}}</label>
            <select name="system.type.value">
              <option value="nail" {{#if (eq system.type.value "nail")}}selected{{/if}}>{{localize "HKRPG.Item.Weapon.types.nail"}}</option>
              <option value="needle" {{#if (eq system.type.value "needle")}}selected{{/if}}>{{localize "HKRPG.Item.Weapon.types.needle"}}</option>
              <option value="fang" {{#if (eq system.type.value "fang")}}selected{{/if}}>{{localize "HKRPG.Item.Weapon.types.fang"}}</option>
              <option value="hook" {{#if (eq system.type.value "hook")}}selected{{/if}}>{{localize "HKRPG.Item.Weapon.types.hook"}}</option>
              <option value="sling" {{#if (eq system.type.value "sling")}}selected{{/if}}>{{localize "HKRPG.Item.Weapon.types.sling"}}</option>
              <option value="natural" {{#if (eq system.type.value "natural")}}selected{{/if}}>{{localize "HKRPG.Item.Weapon.types.natural"}}</option>
            </select>
          </div>

          <div class="hkrpg-row">
            <label>{{localize "HKRPG.Item.Weapon.quality"}}</label>
            <input type="number" name="system.quality.value" value="{{system.quality.value}}" min="0" step="1" />
          </div>

          <div class="hkrpg-row">
            <label>{{localize "HKRPG.Item.Weapon.damage"}}</label>
            <input type="number" name="system.damage.value" value="{{system.damage.value}}" min="0" step="1" />
          </div>

          <div class="hkrpg-row">
            <label>{{localize "HKRPG.Item.Weapon.hands"}}</label>
            <select name="system.hands.value">
              <option value="0R" {{#if (eq system.hands.value "0R")}}selected{{/if}}>0Р</option>
              <option value="1R" {{#if (eq system.hands.value "1R")}}selected{{/if}}>1Р</option>
              <option value="2R" {{#if (eq system.hands.value "2R")}}selected{{/if}}>2Р</option>
              <option value="2R+" {{#if (eq system.hands.value "2R+")}}selected{{/if}}>2Р+</option>
            </select>
          </div>

          <div class="hkrpg-row">
            <label>{{localize "HKRPG.Item.Weapon.rangeCategory"}}</label>
            <select name="system.range.category.value">
              <option value="melee" {{#if (eq system.range.category.value "melee")}}selected{{/if}}>{{localize "HKRPG.Item.Weapon.ranges.melee"}}</option>
              <option value="reach" {{#if (eq system.range.category.value "reach")}}selected{{/if}}>{{localize "HKRPG.Item.Weapon.ranges.reach"}}</option>
              <option value="ranged" {{#if (eq system.range.category.value "ranged")}}selected{{/if}}>{{localize "HKRPG.Item.Weapon.ranges.ranged"}}</option>
            </select>
          </div>

          <div class="hkrpg-row">
            <label>{{localize "HKRPG.Item.Weapon.rangeDistance"}}</label>
            <input type="number" name="system.range.distance.value" value="{{system.range.distance.value}}" min="0" step="1" />
          </div>
        </div>

        <div class="hkrpg-card">
          <h3>Экономика и боевые модификаторы</h3>

          <div class="hkrpg-row">
            <label>{{localize "HKRPG.Item.Weapon.weight"}}</label>
            <input type="number" name="system.weight.value" value="{{system.weight.value}}" min="0" step="1" />
          </div>

          <div class="hkrpg-row">
            <label>{{localize "HKRPG.Item.Common.price"}}</label>
            <input type="number" name="system.price.value" value="{{system.price.value}}" min="0" step="1" />
          </div>

          <div class="hkrpg-row">
            <label>{{localize "HKRPG.Item.Weapon.initiativeBonus"}}</label>
            <input type="number" name="system.initiativeBonus.value" value="{{system.initiativeBonus.value}}" step="1" />
          </div>

          <div class="hkrpg-row">
            <label>{{localize "HKRPG.Item.Weapon.rerolls"}}</label>
            <input type="number" name="system.rerolls.value" value="{{system.rerolls.value}}" min="0" step="1" />
          </div>

          <div class="hkrpg-row">
            <label>{{localize "HKRPG.Item.Weapon.durability"}}</label>
            <input type="number" name="system.durability.value" value="{{system.durability.value}}" min="0" step="1" />
            <span>/</span>
            <input type="number" name="system.durability.max" value="{{system.durability.max}}" min="0" step="1" />
          </div>

          <hr />

          <h4 style="margin:0 0 6px; color: var(--hk-muted);">Улучшение</h4>

          <div class="hkrpg-row">
            <label>{{localize "HKRPG.Item.Weapon.upgradeTier"}}</label>
            <select name="system.upgrade.tier.value">
              <option value="none" {{#if (eq system.upgrade.tier.value "none")}}selected{{/if}}>Нет</option>
              <option value="sharpened" {{#if (eq system.upgrade.tier.value "sharpened")}}selected{{/if}}>Заточенное</option>
              <option value="scored" {{#if (eq system.upgrade.tier.value "scored")}}selected{{/if}}>Изборожденное</option>
              <option value="twisted" {{#if (eq system.upgrade.tier.value "twisted")}}selected{{/if}}>Витое</option>
              <option value="tempered" {{#if (eq system.upgrade.tier.value "tempered")}}selected{{/if}}>Кованое</option>
              <option value="perfected" {{#if (eq system.upgrade.tier.value "perfected")}}selected{{/if}}>Доведённое</option>
            </select>
          </div>

          <div class="hkrpg-row">
            <label>{{localize "HKRPG.Item.Weapon.upgradeQualityBonus"}}</label>
            <input type="number" name="system.upgrade.qualityBonus.value" value="{{system.upgrade.qualityBonus.value}}" step="1" />
          </div>

          <div class="hkrpg-row">
            <label>{{localize "HKRPG.Item.Weapon.upgradeRequirementsText"}}</label>
            <textarea name="system.upgrade.requirementsText.value" rows="3">{{system.upgrade.requirementsText.value}}</textarea>
          </div>

          <div class="hkrpg-row">
            <label>{{localize "HKRPG.Item.Weapon.upgradeCostText"}}</label>
            <textarea name="system.upgrade.costText.value" rows="3">{{system.upgrade.costText.value}}</textarea>
          </div>
        </div>

        <div class="hkrpg-card" style="grid-column: 1 / -1;">
          <h3>{{localize "HKRPG.Item.Common.properties"}}</h3>
          <textarea name="system.properties.value" rows="4">{{system.properties.value}}</textarea>
        </div>
      </div>
    </div>

    <!-- MODS -->
    <div class="tab" data-group="primary" data-tab="mods">
      <div class="hkrpg-card">
        <div class="hkrpg-row" style="justify-content:space-between;">
          <h3 style="margin:0;">{{localize "HKRPG.Item.Common.mods"}}</h3>
          <button type="button" data-action="add-mod"><i class="fas fa-plus"></i> Добавить</button>
        </div>

        {{#if system.mods.value.length}}
          <ol class="items-list">
            {{#each system.mods.value as |m idx|}}
            <li class="hkrpg-row" style="align-items:flex-start;">
              <div style="flex:1; display:flex; flex-direction:column; gap:6px;">
                <div class="hkrpg-row">
                  <label style="min-width:120px;">Название</label>
                  <input type="text" name="system.mods.value.{{idx}}.name" value="{{m.name}}" />
                </div>
                <div class="hkrpg-row">
                  <label style="min-width:120px;">Эффект</label>
                  <textarea name="system.mods.value.{{idx}}.effect" rows="3">{{m.effect}}</textarea>
                </div>
                <div class="hkrpg-row">
                  <label style="min-width:120px;">Цена</label>
                  <input type="text" name="system.mods.value.{{idx}}.price" value="{{m.price}}" />
                </div>
                <label class="hkrpg-row" style="gap:8px;">
                  <input type="checkbox" name="system.mods.value.{{idx}}.active" {{checked m.active}} />
                  <span>Активна</span>
                </label>
              </div>

              <button type="button" data-action="remove-mod" data-idx="{{idx}}" title="Удалить модификацию">
                <i class="fas fa-trash"></i>
              </button>
            </li>
            {{/each}}
          </ol>
        {{else}}
          <p style="color: var(--hk-muted); margin:0;">Модификаций нет.</p>
        {{/if}}
      </div>
    </div>

    <!-- DESCRIPTION -->
    <div class="tab" data-group="primary" data-tab="desc">
      <div class="hkrpg-card">
        <h3>{{localize "HKRPG.Item.Common.description"}}</h3>
        {{editor system.description.value target="system.description.value" button=true owner=owner editable=editable}}
      </div>
    </div>
  </section>
</form>
